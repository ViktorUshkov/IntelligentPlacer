# Intelligent Placer

**Описание программы:**

На вход подаётся фотография, на которой изображены несколько предметов и многоугольник, начерченный черным маркером на белом листе бумаги. Intelligent Placer по данным, поданным на вход, должен определить: можно ли разместить все предметы вместе на фотографии в предоставленном многоугольнике?

*Вход:* фотография с объектами и многоугольником (путь до фотографии в файловой системе)

*Выход:* булево значение True (если входные данные корректны* и предметы помещаются во многоугольник) или False (если входные данные некорректны, или предметы не помещаются во многоугольник)

**данные считаются корректными, если на фото присутствуют и лист бумаги с многоугольником, удовлетворяющим требованиям замкнутости и выпуклости, и хотя бы один предмет из папки items; в ином случае данные считаются некорректными*

**Фотометрические требования:**

•	Формат фотографий - *.jpg, *.jpeg

•	Направление камеры – перпендикулярно плоскости, на которой расположены предметы и лист с многоугольником

•	Предметы и их границы не должны сливаться с поверхностью

**Требования к листу, многоугольнику и объектам:** 

•	Формат листа бумаги - A4

•	Многоугольник должен быть замкнутым и выпуклым

•	Многоугольник чертится черным маркером на белом листе бумаги

•	Не разрешается использование объектов, не указанных в папке items

•	Один объект не может присутствовать на фотографии более одного раза

•	Лист бумаги с многоугольником и объекты целиком помещаются на фотографии

•	Объекты на фотографии не пересекаются друг с другом и не пересекаются с листом бумаги и с многоугольником

• Объекты располагаются в нижней части фотографии; лист с многоугольником - в верхней


**Фотографии предметов и поверхности**

[предметы и поверхность](https://github.com/ViktorUshkov/IntelligentPlacer/tree/develop/items)

**Примеры входных фотографий**

[размеченные примеры](https://github.com/ViktorUshkov/IntelligentPlacer/blob/develop/MarkedUpDataTests.md)

**План:**

1) *Обнаружение многоугольника и предметов:* Согласно измененным требованиям к листу и объектам, в верхней части фотографии должен находиться лист с многоугольником, а в нижней - объекты. Можно разделить фотографии из датасета на две по средней линии и работать как с отдельными. После этого находим контуры многоугольника и предметов с помощью, например, детектора canny и морфологических операций
2) *Предварительная проверка:* чтобы исключить случаи, когда сразу понятно, что предметы не поместятся или когда контуры не были найдены, введём предварительную проверку. Если сумма площадей предметов больше площади многоугольника или контуры многоугольника или предметов не обнаружены - сразу выводим False. 
3) *Упаковка предметов во многоугольник:* укладываем предметы начиная с самого большого, заканчивая самым маленьким. При этом пытаемся расположить предмет разумным образом; т. е. так, чтобы соприкосновение границ предмета и многоугольника было как можно большим (пример приведен на рисунке ниже: черным обозначен многоугольник, красным – предмет, укладываемый во многоугольник). Для каждого следующего шага учитываем уже расположенные предметы (по сути уменьшаем исходный многоугольник на площадь расположенных предметов). Если для какого-то из предметов место уже не находится – выводим False, если упаковка прошла успешно для всех предметов – выводим True

*Замечание: на данный момент реализовать алгоритм с разумным расположением предметов не удалось, к 3-й итерации был реализован переборный алгоритм с шагом перебора: задаём шаги по осям и углу и обходим многоугольник, стараясь расположить предмет в пределах его контура. Если не получилось в данной точке расположить сразу предмет, то пробуем поворачивать его на заданный угол-шаг. Если в результате прохода по многоугольнику место так и не нашлось, то возвращаем False, иначе располагаем предмет на найденном месте и переходим к следующему. Предметы укладываются от большего радиусу описанной окружности к меньшему* 


*пример разумного укладывания предметов во многоугольник*
![example](https://user-images.githubusercontent.com/63870567/193135669-f9ae55d1-435d-4fa9-9a48-08b6b547c580.png)


# Ход работы

**1 итерация**

Программа по поданному пути считывает датасет и после применения морфологических операций достаточно хорошо обнаруживает контуры предметов и многоугольника.

**2 итерация**

Начата работа над алгоритмом, добавлены функции, предпроверяющие явную невозможность размещения предметов в контуре многоугольника (т.е. обрабатываются следующие False случаи: отсутствие собственно контуров, сумма всех площадей предметов больше площади многоугольника, радиус описанной окружности одного из предметов больше радиуса описанной окружности многоугольника)

**3 итерация** 

Подобраны более оптимальные параметры для выделения контура предметов, добавлены новые тесты. Реализован неидеальный алгоритм на основе перебора состояний с шагом перебора по осям и углу поворота, показавший на датасете точность 86.36% за приблизительно 35 секунд на 22 теста, с отсутствием ложноположительных ответов.

